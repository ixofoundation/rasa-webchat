## ixo-Assistant Custom Responses

The ixo contextual AI assistant will become a powerful, intelligent interface for users to understand how ixo works and to efficiently get things done.

Custom Responses provide highly customisable methods for the ixo-AI to interact with the ixo-Assistant Client SDK.

Custom responses are generated by the ixo-AI within the context of a converation, initiated by a specific user intent. Each response is configured to instruct the Assistant Client what to do at specific points in this conversation.
For instance, after the user has provided all the necessary information to process a transaction.

The ixo-AI responds with data from processes it has executed, such as identifying the user's intent, extracting entities, performing custom actions, collecting data inputs, and confirming the user's responses.

*(Note that Custom Responses are not the same as Custom Actions, which are server-side operations that can be configured to process almost any types of information and to interact with almost any external system).* 

Custom Responses should not typically be shown to the user in the Assistant interface (unlike standard `bot_utters` responses). 
Instead, Custom Responses are processed by the Client to coordinate functions within the application. 
For example, the Assistant SDK sends the data from a custom response to the Client Wallet, where this is compiled into a standard message format, cryptographically signed and broadcast as a blockchain transaction. 

### Custom Response data model
A Custom Response is an object with: 
- **Response properties** to instruct the Assistant Client SDK what custom component must be used to perform a specified function for the identified application user.
- **Data Properties** containing a payload for the Client to process. 

### ixo-Assistant Client Triggers
A standard set of Trigger values map to specific functions in the ixo-Assistant Client SDK.
These triggers may be extended by developers building additional features into the Assistant Client SDK.  

Trigger Value         | Client Response
--------------|------------------
proto_msg | Forms a blockchain transaction message from the Custom Response data and passes this to the wallet component for signing and broadcasting
cellnode_msg | Forms a blockchain transaction message from the Custom Response data and passes this to the wallet component for signing and transmission to a Cell Node endpoint.
alert | Displays an alert message to the user in a custom format
actions | Displays a set of Action buttons in the Actions Panel of client apps 
redirect | Routes to a specified URI for display by the user's web-client
assistant | Changes the state of the ixo-assistant Client, which may modify the chatbot user interface
wallet_connect | Sends the Custom Response payload to a specified connected device, using WalletConnect 
fetch_raw | Gets data from a specified service endpoint and displays this in a modal
send_message | Sends a message to another user through the DID-Comm protocol (future)

## Trigger Types
Each Custom Response Trigger can perform functions of different types. 
In the current Client SDK implementation, it is only possible for a trigger to perform one type of function in a response. Multiple functions can be implemented through multiple sequential responses.

### Trigger types for `proto_msg`
 * cosmos-sdk/MsgSend
 * cosmos-sdk/MsgMultiSend
 * cosmos-sdk/MsgCreateValidator
 * cosmos-sdk/MsgEditValidator
 * cosmos-sdk/MsgDelegate
 * cosmos-sdk/MsgUndelegate
 * cosmos-sdk/MsgBeginRedelegate
 * cosmos-sdk/MsgWithdrawDelegationReward
 * cosmos-sdk/MsgWithdrawValidatorCommission
 * cosmos-sdk/MsgModifyWithdrawAddress
 * cosmos-sdk/MsgSubmitProposal
 * cosmos-sdk/MsgDeposit
 * cosmos-sdk/MsgVote
 * cosmos-sdk/MsgUnjail
 * bonds/MsgCreateBond
 * bonds/MsgEditBond
 * bonds/MsgBuy
 * bonds/MsgSell
 * bonds/MsgSwap
 * bonds/MsgMakeOutcomePayment
 * bonds/MsgWithdrawShare
 * did/AddDid
 * did/AddCredential
 * payments/MsgCreatePaymentTemplate
 * payments/MsgCreatePaymentContract
 * payments/MsgCreateSubscription
 * payments/MsgSetPaymentContractAuthorisation
 * payments/MsgGrantDiscount
 * payments/MsgRevokeDiscount
 * payments/MsgEffectPayment
 * project/CreateProject
 * project/UpdateProjectStatus
 * project/CreateAgent
 * project/UpdateAgent
 * project/CreateClaim
 * project/CreateEvaluation
 * project/WithdrawFunds
 * treasury/MsgSend
 * treasury/MsgOracleTransfer
 * treasury/MsgOracleMint
 * treasury/MsgOracleBurn

### Trigger types for `actions`
 * getActions

### Entity Values for `getActions`
* "trigger":"getActions"
* “page”:”<name of the current app page>”
* “authenticated”:”true | false” // if the user is logged in
* “userID”:”<did of the signed-in user>”
* “walletConnect”:”true|false” // if the user has an active walletConnect connection
* “agentRole”:”SA|EA|IA|nul” // the user’s approved agent role/s in relation to the entity
* “entityID”:”<did of the entity>”
* “creator”:”true|false” // if the user is the entity creator
* “conversation_id”:”<id>”  // A unique ID which was generated by the webclient on starting a conversation
* “action”:”<defined by client>” // any additional arbitrary action entity/entities created by the client, for extending the action panel range of options

### Trigger types for `cellnode_msg`
 * listProjects
 * listProjectsFiltered
 * getByProjectDid
 * getByProjectSenderDid
 * getProjectAccounts
 * shields
 [To be completed]

### Trigger types for `alert`
* success
* failure
* warning
* note

### Trigger types for `redirect` 
* external
* internal

### Trigger types for `assistant`
* restart
* close
* open
* share
* scan_qr
* locate
* play_media
* record_audio
* record_video
* record_photo
* display_qr
* identify
* authenticate

### Trigger types for `wallet_connect`
* connect
* disconnect
* session_request
* session_update
* call_request
* wc_sessionRequest
* wc_sessionUpdate

### Trigger types for `fetch_raw`
* blocksync
* blockscan
* public_cellnode

### Trigger types for `send_message`
*(P2P messsaging and broacasts are future features)*

---
## Examples of Custom Responses

### New Transaction
Example request from the client:
 `/new_transaction{
  "trigger":"proto_msg",
  "type":"cosmos-sdk/MsgSend",
  "denom":"uixo","wallet_address":"ixo1yq3jv9fvq9azpt6xsqlf3vnfcw32s8jtx57vjt"
  }`
 
 ```
 custom:
  response:
    trigger: '{trigger}'
    type: '{type}'
    did: '{user_did}'
  data:
    value:
      - amount: '{amount}'
        denom: '{token}'
    to_address: '{to_address}'
    from_address: '{wallet_address}'
```
  
  ### Buy IXO
Example request from the client:
`/buy_ixo{
  "trigger":"redirect",
  "type":"internal",
  "endpoint":"https://subscribe.ixo.world",
  "user_did":","did:ixo:CiPYfm8c83af2UraeDnNSk"
  "wallet_address":"ixo1yq3jv9fvq9azpt6xsqlf3vnfcw32s8jtx57vjt",
  "chain_id":"impact_hub_1" 
  }`
    
// Future: `Custom Action` using the Action Server to check if user has kyc, check if user has IXO balance
  
 ```
 custom:
    response:
       trigger: '{trigger}'
       type: '{type}'
    data:
       endpoint: {'uri'}
       did: '{walletDid}'
       account:{'walletAddress'}
       conversation:{'conversation_id'} // need to confirm keys
       chain_id:{'chain_id'}
```

### Swap Tokens
Example request from the client:
`/swap{
  "trigger":"proto_msg",
  "type":"bonds/MsgSwap",
  "bond_did":"did:ixo:CiPYfm8c83af2UraeDnNSk",
  "to_token":"uixo"
  }`
  
 ```
custom:
  response:
    trigger: '{trigger}'
    type: '{type}'
    did: '{user_did}'
  data:
    value:
      - amount: '{amount}'
        denom: '{token}'
    swapper_did: '{wallet_did}'
    bond_did: '{bond_did}'
    to_token: '{to_token}'
```
---    
## Entities/Slots 
Here is a growing list of parameters which are recognised by the Assistant and are available to be returned in custom responses.

* wallet_did
* Wallet_address
* amount
* token
* denom
* recipient
* delegator_address
* validator_address
* uri
* endpoint
* to_address
* account
* user_did
* did
* chain_Id
* memo
* conversation // need to confirm keys
* conversation_id' // need to confirm keys
* swapper_did
* bond_did
* to_token
* account_number
* sequence
* fee_amount
* fee_denom
